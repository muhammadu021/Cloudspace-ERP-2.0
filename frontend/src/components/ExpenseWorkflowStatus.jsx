import React from 'react';\nimport { \n  CheckCircle, \n  Clock, \n  XCircle, \n  ArrowRight, \n  User, \n  AlertTriangle,\n  RotateCcw\n} from 'lucide-react';\n\nconst ExpenseWorkflowStatus = ({ expense, workflowHistory = [] }) => {\n  const getStatusIcon = (status, actionTaken) => {\n    switch (status) {\n      case 'completed':\n        if (actionTaken === 'approved') {\n          return <CheckCircle className=\"h-5 w-5 text-green-500\" />;\n        } else if (actionTaken === 'rejected') {\n          return <XCircle className=\"h-5 w-5 text-red-500\" />;\n        } else if (actionTaken === 'returned') {\n          return <RotateCcw className=\"h-5 w-5 text-yellow-500\" />;\n        }\n        return <CheckCircle className=\"h-5 w-5 text-green-500\" />;\n      case 'in_progress':\n      case 'pending':\n        return <Clock className=\"h-5 w-5 text-primary\" />;\n      default:\n        return <Clock className=\"h-5 w-5 text-gray-400\" />;\n    }\n  };\n\n  const getStatusColor = (status, actionTaken) => {\n    switch (status) {\n      case 'completed':\n        if (actionTaken === 'approved') return 'text-green-600 bg-green-50';\n        if (actionTaken === 'rejected') return 'text-red-600 bg-red-50';\n        if (actionTaken === 'returned') return 'text-yellow-600 bg-yellow-50';\n        return 'text-green-600 bg-green-50';\n      case 'in_progress':\n        return 'text-primary bg-primary-50';\n      case 'pending':\n        return 'text-gray-600 bg-gray-50';\n      default:\n        return 'text-gray-400 bg-gray-50';\n    }\n  };\n\n  const getOverallStatus = () => {\n    if (expense.status === 'approved') {\n      return {\n        label: 'Approved',\n        color: 'text-green-600 bg-green-100',\n        icon: <CheckCircle className=\"h-4 w-4\" />\n      };\n    } else if (expense.status === 'rejected') {\n      return {\n        label: 'Rejected',\n        color: 'text-red-600 bg-red-100',\n        icon: <XCircle className=\"h-4 w-4\" />\n      };\n    } else if (expense.status === 'returned') {\n      return {\n        label: 'Returned for Revision',\n        color: 'text-yellow-600 bg-yellow-100',\n        icon: <RotateCcw className=\"h-4 w-4\" />\n      };\n    } else if (expense.status === 'pending') {\n      return {\n        label: 'Under Review',\n        color: 'text-primary bg-blue-100',\n        icon: <Clock className=\"h-4 w-4\" />\n      };\n    } else {\n      return {\n        label: expense.status?.charAt(0).toUpperCase() + expense.status?.slice(1) || 'Unknown',\n        color: 'text-gray-600 bg-gray-100',\n        icon: <Clock className=\"h-4 w-4\" />\n      };\n    }\n  };\n\n  const overallStatus = getOverallStatus();\n\n  return (\n    <div className=\"bg-white rounded-lg shadow p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-medium text-gray-900\">Approval Workflow</h3>\n        <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${overallStatus.color}`}>\n          {overallStatus.icon}\n          <span className=\"ml-2\">{overallStatus.label}</span>\n        </div>\n      </div>\n\n      {/* Approval Path Info */}\n      {expense.approval_path && (\n        <div className=\"mb-6 p-4 bg-gray-50 rounded-lg\">\n          <div className=\"flex items-center space-x-2\">\n            <AlertTriangle className=\"h-4 w-4 text-primary\" />\n            <span className=\"text-sm font-medium text-gray-700\">\n              Approval Path: {expense.approval_path === 'high_value' ? 'High Value (Procurement → Finance)' : 'Standard (HR → Finance)'}\n            </span>\n          </div>\n          {expense.approval_path === 'high_value' && (\n            <p className=\"text-xs text-gray-600 mt-1\">\n              This expense exceeds the threshold and requires procurement approval.\n            </p>\n          )}\n        </div>\n      )}\n\n      {/* Workflow Steps */}\n      <div className=\"space-y-4\">\n        {workflowHistory.length > 0 ? (\n          workflowHistory.map((step, index) => (\n            <div key={step.step_number} className=\"flex items-start space-x-4\">\n              <div className=\"flex-shrink-0\">\n                {getStatusIcon(step.status, step.action_taken)}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center justify-between\">\n                  <h4 className=\"text-sm font-medium text-gray-900\">\n                    {step.step_name}\n                  </h4>\n                  <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(step.status, step.action_taken)}`}>\n                    {step.status === 'completed' ? (\n                      step.action_taken?.charAt(0).toUpperCase() + step.action_taken?.slice(1)\n                    ) : (\n                      step.status?.charAt(0).toUpperCase() + step.status?.slice(1)\n                    )}\n                  </span>\n                </div>\n                \n                {step.approver && (\n                  <div className=\"flex items-center mt-1 text-sm text-gray-600\">\n                    <User className=\"h-3 w-3 mr-1\" />\n                    <span>{step.approver.name}</span>\n                  </div>\n                )}\n                \n                {step.completed_at && (\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {step.action_taken === 'approved' ? 'Approved' : \n                     step.action_taken === 'rejected' ? 'Rejected' : \n                     step.action_taken === 'returned' ? 'Returned' : 'Completed'} on{' '}\n                    {new Date(step.completed_at).toLocaleDateString()} at{' '}\n                    {new Date(step.completed_at).toLocaleTimeString()}\n                  </p>\n                )}\n                \n                {step.comments && (\n                  <div className=\"mt-2 p-2 bg-gray-50 rounded text-sm text-gray-700\">\n                    <span className=\"font-medium\">Comments: </span>\n                    {step.comments}\n                  </div>\n                )}\n              </div>\n              \n              {index < workflowHistory.length - 1 && (\n                <div className=\"flex-shrink-0 ml-4\">\n                  <ArrowRight className=\"h-4 w-4 text-gray-400\" />\n                </div>\n              )}\n            </div>\n          ))\n        ) : (\n          <div className=\"text-center py-8\">\n            <Clock className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <h4 className=\"text-sm font-medium text-gray-900 mb-2\">Workflow Pending</h4>\n            <p className=\"text-sm text-gray-600\">\n              The approval workflow will begin once the expense is submitted.\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Current Step Info */}\n      {expense.current_approval_step && expense.status === 'pending' && (\n        <div className=\"mt-6 p-4 bg-primary-50 rounded-lg\">\n          <div className=\"flex items-center space-x-2\">\n            <Clock className=\"h-4 w-4 text-primary\" />\n            <span className=\"text-sm font-medium text-primary-700\">\n              Currently at step {expense.current_approval_step}\n            </span>\n          </div>\n          <p className=\"text-xs text-primary mt-1\">\n            Waiting for approval from the assigned reviewer.\n          </p>\n        </div>\n      )}\n\n      {/* Rejection/Return Reason */}\n      {(expense.status === 'rejected' || expense.status === 'returned') && expense.rejection_reason && (\n        <div className={`mt-6 p-4 rounded-lg ${\n          expense.status === 'rejected' ? 'bg-red-50' : 'bg-yellow-50'\n        }`}>\n          <div className=\"flex items-center space-x-2 mb-2\">\n            {expense.status === 'rejected' ? (\n              <XCircle className=\"h-4 w-4 text-red-500\" />\n            ) : (\n              <RotateCcw className=\"h-4 w-4 text-yellow-500\" />\n            )}\n            <span className={`text-sm font-medium ${\n              expense.status === 'rejected' ? 'text-red-700' : 'text-yellow-700'\n            }`}>\n              {expense.status === 'rejected' ? 'Rejection Reason' : 'Return Reason'}\n            </span>\n          </div>\n          <p className={`text-sm ${\n            expense.status === 'rejected' ? 'text-red-600' : 'text-yellow-600'\n          }`}>\n            {expense.rejection_reason}\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ExpenseWorkflowStatus;